<!DOCTYPE html>
<html>
<head>

<script>
    !function(o,p,s,e,c){
        var i,a,h,u=[],d=[];function t(){var t="You must provide a supported major version.";try{if(!c)throw new Error(t);var e,n="https://cdn.smooch.io/",r="smooch";if((e="string"==typeof this.response?JSON.parse(this.response):this.response).url){var o=p.getElementsByTagName("script")[0],s=p.createElement("script");s.async=!0;var i=c.match(/([0-9]+)\.?([0-9]+)?\.?([0-9]+)?/),a=i&&i[1];if(i&&i[3])s.src=n+r+"."+c+".min.js";else{if(!(4<=a&&e["v"+a]))throw new Error(t);s.src=e["v"+a]}o.parentNode.insertBefore(s,o)}}catch(e){e.message===t&&console.error(e)}}o[s]={init:function(){i=arguments;var t={then:function(e){return d.push({type:"t",next:e}),t},catch:function(e){return d.push({type:"c",next:e}),t}};return t},on:function(){u.push(arguments)},render:function(){a=arguments},destroy:function(){h=arguments}},o.__onWebMessengerHostReady__=function(e){if(delete o.__onWebMessengerHostReady__,o[s]=e,i)for(var t=e.init.apply(e,i),n=0;n<d.length;n++){var r=d[n];t="t"===r.type?t.then(r.next):t.catch(r.next)}a&&e.render.apply(e,a),h&&e.destroy.apply(e,h);for(n=0;n<u.length;n++)e.on.apply(e,u[n])};var n=new XMLHttpRequest;n.addEventListener("load",t),n.open("GET","https://"+e+".webloader.smooch.io/",!0),n.responseType="json",n.send()
        }(window,document,"Smooch","6134970353011900d7d80485","5");
</script>
</head>
<body>
<h1>Jahez</h1>
<p>Please click the widget below</p>


<script>
Smooch.init({
    integrationId: '6134970353011900d7d80485',
    locale: 'ar-SA',
    customText: {
        // ...
        conversationTimestampHeaderFormat: 'DD MMMM YYYY, hh:mm',
        // ...
    },
  
      delegate: {
            beforeDisplay(message, data) {
            if (message.metadata && message.metadata.isHidden) {
                  return null;
              }
              return message;
            }
        }


})
    .then(function() {
        Smooch.login(
            'mintsev+driver@gmail.com',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6ImFwcF82MTI3OTIxMzMyZjMxODAwZDc0NzllODgifQ.eyJzY29wZSI6ImFwcFVzZXIiLCJ1c2VySWQiOiJtaW50c2V2K2RyaXZlckBnbWFpbC5jb20ifQ.M90Q1lsnNLRd8gSGfKsulzS5aJNNDAi8t0kml0GyOEc'
        )
            .then(
                function () {
                    console.log('Login: success');
                    Smooch.updateUser({
                        givenName: 'Anton',
                        surname: 'Driver',
                        email: 'mintsev+driver@gmail.com',
                        signedUpAt: Date.now(),
                        properties: {
                            customerType: 'driver'
                        }
                    });
                },
                function (err) {
                    console.log(err);
                }
            )
    });

Smooch.on('widget:opened', function () {
    console.log('Widget is opened!');
    //Get Conversation & Send Message
  var Conversations = Smooch.getConversations()
            if ( Conversations.length == 0){
                //Create Conversation
                Smooch.createConversation({
                    displayName: "Welcome!!",
                    description: "New Conversation",
                });
            } 
            //Send Start Over on User's behalf to Trigger Answer Bot
            //Smooch.getConversationById().then(function(conversation) {
                //alert("Existing Conversation");
                Smooch.sendMessage(
                {
                    type: 'text',
                    text: 'Driver',
                    metadata: {
                      isHidden:true
                    }
                },
                Conversations[0].id,
                ); 
                //}
            //);
});
</script>
</body>
</html>